# train_mv_page4d_lite.py ç½‘ç»œç»“æ„åˆ†ææŠ¥å‘Š

## 1. å®Œæ•´ç½‘ç»œç»“æ„æ¦‚è¿°ï¼ˆä»è¾“å…¥åˆ°è¾“å‡ºï¼‰

### 1.1 è¾“å…¥å±‚
- **è¾“å…¥æ ¼å¼**ï¼š
  - å¤šè§†è§’æ¨¡å¼ï¼š`[B, T, V, 3, H, W]`
    - B: batch size (é€šå¸¸ä¸º1)
    - T: æ—¶é—´æ­¥æ•° (ä¾‹å¦‚ 6-24 å¸§)
    - V: è§†è§’æ•° (ä¾‹å¦‚ 4 ä¸ªè§†è§’)
    - 3: RGB é€šé“
    - H, W: å›¾åƒé«˜å®½ (ä¾‹å¦‚ 378Ã—378)
  - Legacyæ¨¡å¼ï¼š`[B, S, 3, H, W]` (å‘åå…¼å®¹)

### 1.2 Patch Embedding (Stage-0ä¹‹å‰)
- **ç»´åº¦å˜åŒ–**ï¼š`[B*S, 3, H, W]` â†’ `[B*S, P, C]`
  - S = T * V (å¤šè§†è§’æ¨¡å¼) æˆ– S = T (legacyæ¨¡å¼)
  - P = (H/patch_size) Ã— (W/patch_size) = 27 Ã— 27 = 729 (å¯¹äº 378Ã—378, patch_size=14)
  - C = embed_dim = 1024
- **ä½¿ç”¨**ï¼šDINOv2 ViT-L/14 ä½œä¸ºbackbone

### 1.3 ViewMixer (Stage-0) - **æ–°å¢æ¨¡å—**
- **è¾“å…¥**ï¼š`[B, T, V, P, C]` (reshape from `[B*S, P, C]`)
- **å¤„ç†**ï¼š
  - å¯¹æ¯ä¸ªæ—¶é—´æ­¥ tï¼Œåœ¨è§†è§’ç»´åº¦ V ä¸Šè¿›è¡Œè·¨è§†è§’æ³¨æ„åŠ›
  - ä½¿ç”¨ LoRA (Low-Rank Adaptation) é™ä½å‚æ•°é‡
  - å¤šå¤´æ³¨æ„åŠ›ï¼šnum_heads=8
- **è¾“å‡º**ï¼š`[B, T, V, P, C]` (ç›¸åŒç»´åº¦ï¼Œä½†ç‰¹å¾å·²èåˆ)
- **ç›®çš„**ï¼šåœ¨è¿›å…¥ä¸»Transformerä¹‹å‰ï¼Œå…ˆè¿›è¡Œè·¨è§†è§’å¯¹é½

### 1.4 Token ç»„è£…ä¸åµŒå…¥æ³¨å…¥
- **Tokenç»“æ„**ï¼š
  - Camera tokens: `[B, V, 1, C]` (æ¯ä¸ªè§†è§’ä¸€ä¸ªï¼Œè·¨æ—¶é—´å…±äº«)
  - Register tokens: `[B, T, num_register_tokens, C]` (æ¯ä¸ªæ—¶é—´æ­¥4ä¸ª)
  - Patch tokens: `[B*S, P, C]` (æ¥è‡ªViewMixer)
  
- **å±•å¼€ä¸æ‹¼æ¥**ï¼š
  - Camera token: `[B, V, 1, C]` â†’ `[B*T*V, 1, C]` (å±•å¼€åˆ°æ¯ä¸ª(t,v)å¯¹)
  - Register token: `[B, T, 4, C]` â†’ `[B*T*V, 4, C]`
  - æ‹¼æ¥ï¼š`[B*S, 1+4+P, C]` = `[B*S, 1+4+729, C]` = `[B*S, 734, C]`

- **ä½ç½®åµŒå…¥æ³¨å…¥**ï¼š
  - Rotary Position Embedding (RoPE) åº”ç”¨äºpatch tokens
  - ç‰¹æ®Štokens (camera, register) çš„ä½ç½®åµŒå…¥è®¾ä¸º0

- **æ–°å¢åµŒå…¥**ï¼ˆ**ç›¸æ¯”vggt_t_mask_mlp_fin10çš„æ”¹è¿›**ï¼‰ï¼š
  - Time embedding: `E_time[t]` â†’ æ·»åŠ åˆ°patch tokens
  - View embedding: `E_view[v]` â†’ æ·»åŠ åˆ°patch tokens
  - Camera parameter embedding: `E_cam(v)` â†’ æ·»åŠ åˆ°camera token
  - æœ€ç»ˆtokens: `[B*S, 734, 1024]`

### 1.5 äº¤æ›¿æ³¨æ„åŠ›æœºåˆ¶ (24å±‚ Transformer Blocks)

#### Stage-1 (Layers 0-7): å¤šè§†è§’èšåˆé˜¶æ®µ
- **Frame Attention (8å±‚)**ï¼š
  - **è·¯ç”±ç­–ç•¥**ï¼šMulti-view routing
  - è¾“å…¥ï¼š`[B*S, 734, 1024]`
  - Reshape: `[B, T, V, 734, 1024]` â†’ `[B*T, V*734, 1024]`
  - **ç›®çš„**ï¼šåŒä¸€æ—¶é—´æ­¥å†…ï¼Œä¸åŒè§†è§’ä¹‹é—´è¿›è¡Œæ³¨æ„åŠ›ï¼Œèšåˆå¤šè§†è§’ä¿¡æ¯
  - è¾“å‡ºï¼š`[B*T, V*734, 1024]` â†’ reshapeå› `[B*S, 734, 1024]`

- **Global Attention (8å±‚)**ï¼š
  - è¾“å…¥ï¼š`[B, S*734, 1024]`
  - **ç›®çš„**ï¼šå…¨å±€åºåˆ—çº§åˆ«çš„æ³¨æ„åŠ›
  - è¾“å‡ºï¼š`[B, S*734, 1024]`

- **Layer 7 åç”ŸæˆMask**ï¼š
  - SpatialMaskHead ç”ŸæˆåŠ¨æ€åŒºåŸŸmask
  - `cached_key_bias_1d`: `[B, S*P]`
  - `cache_mask`: `[B, S*P]` (ç”¨äºåç»­å±‚çš„masking)

#### Stage-2 (Layers 8-17): æ—¶åºå»ºæ¨¡é˜¶æ®µ
- **Frame Attention (10å±‚)**ï¼š
  - **è·¯ç”±ç­–ç•¥**ï¼šTemporal routing
  - Reshape: `[B, T, V, 734, 1024]` â†’ `[B*V, T*734, 1024]`
  - **ç›®çš„**ï¼šåŒä¸€è§†è§’å†…ï¼Œä¸åŒæ—¶é—´æ­¥ä¹‹é—´è¿›è¡Œæ³¨æ„åŠ›ï¼Œå»ºæ¨¡æ—¶åºä¸€è‡´æ€§
  - è¾“å‡ºï¼š`[B*V, T*734, 1024]` â†’ reshapeå› `[B*S, 734, 1024]`

- **Global Attention (10å±‚)**ï¼š
  - åº”ç”¨mask: `cache_mask` (å¼±åŒ–åŠ¨æ€åŒºåŸŸ)
  - å¯å­¦ä¹ é—¨æ§: `camera_mask_gate` (Î³) æ§åˆ¶maskå¼ºåº¦
  - Camera branch: å¼±masking (Î³ Ã— mask)
  - Register branch: å¼ºmasking (å®Œæ•´mask)

#### Stage-3 (Layers 18-23): æ··åˆè·¯ç”±é˜¶æ®µ
- **Frame Attention (6å±‚)**ï¼š
  - å‰3å±‚ (18-20): Temporal routing (å¦‚Stage-2)
  - å3å±‚ (21-23): Multi-view routing (å¦‚Stage-1)
  - **ç›®çš„**ï¼šå¹³è¡¡æ—¶åºå’Œè§†è§’ä¿¡æ¯

- **Global Attention (6å±‚)**ï¼š
  - ç»§ç»­åº”ç”¨maskå’Œé—¨æ§æœºåˆ¶

### 1.6 ç‰¹å¾èšåˆ
- **æ¯å±‚è¾“å‡º**ï¼š
  - Frame intermediate: `[B, S, 734, 1024]`
  - Global intermediate: `[B, S, 734, 1024]`
  - Concat: `[B, S, 734, 2048]` (2Ã—embed_dim)
- **24å±‚æ€»è¾“å‡º**ï¼š`output_list[24]`ï¼Œæ¯å±‚ `[B, S, 734, 2048]`

### 1.7 è¾“å‡ºå¤´ (Heads)

#### CameraHead
- **è¾“å…¥**ï¼š`aggregated_tokens_list[-1]` â†’ `[B, T*V, 734, 2048]`
- **æå–Camera tokens**ï¼š`[B, V, 2048]` (ä»ç¬¬ä¸€ä¸ªæ—¶é—´æ­¥æå–ï¼Œæ¯ä¸ªè§†è§’)
- **è¿­ä»£ç»†åŒ–** (4æ¬¡è¿­ä»£)ï¼š
  - Trunk (4å±‚Transformer blocks)
  - Adaptive LayerNormè°ƒåˆ¶
  - Pose branch (MLP)
- **è¾“å‡º**ï¼š`pose_enc`: `[B, V, 9]` (å¹³ç§»3 + å››å…ƒæ•°4 + FOV 2)

#### DepthHead (DPTHead)
- **è¾“å…¥**ï¼š`aggregated_tokens_list` + `images`
- **ä¸­é—´å±‚ç´¢å¼•**ï¼š[4, 11, 17, 23]
- **å¤„ç†æµç¨‹**ï¼š
  1. æå–æŒ‡å®šå±‚çš„patch tokens: `[B, S, P, 2048]`
  2. Projection: `[B, S, P, 256/512/1024/1024]`
  3. Resize layers (ä¸Šé‡‡æ ·/ä¸‹é‡‡æ ·)
  4. Fusion blocks (4å±‚)
  5. Output conv
- **è¾“å‡º**ï¼š
  - Depth: `[B, T, V, 1, H, W]`
  - Confidence: `[B, T, V, 1, H, W]` (å€¼åŸŸ [1, +âˆ))

#### PointHead (DPTHead)
- **ç±»ä¼¼DepthHeadç»“æ„**
- **è¾“å‡º**ï¼š
  - World points: `[B, T, V, 3, H, W]` (3Dåæ ‡)
  - Confidence: `[B, T, V, 1, H, W]`

#### TrackHead (å¯é€‰)
- **è¾“å…¥**ï¼š`aggregated_tokens_list` + `query_points`
- **è¾“å‡º**ï¼š
  - Tracks: `[B, T, N, 2]` (Nä¸ªæŸ¥è¯¢ç‚¹çš„è½¨è¿¹)
  - Visibility: `[B, T, N]`
  - Confidence: `[B, T, N]`

---

## 2. ç›¸æ¯” vggt_t_mask_mlp_fin10 çš„ä¿®æ”¹

### 2.1 æ ¸å¿ƒæ¶æ„ä¿®æ”¹

#### âœ… ä¿®æ”¹1: æ–°å¢ ViewMixer (Stage-0)
- **ä½ç½®**ï¼šPatch embeddingä¹‹åï¼ŒTokenç»„è£…ä¹‹å‰
- **åŠŸèƒ½**ï¼šè½»é‡çº§è·¨è§†è§’æ³¨æ„åŠ›æ¨¡å—
- **å®ç°**ï¼š
  - LoRA-based QKVæŠ•å½±ï¼ˆå‚æ•°é‡å°ï¼‰
  - å¤šå¤´æ³¨æ„åŠ› (8 heads)
  - Gated residual connection
- **åˆç†æ€§**ï¼šâœ… **åˆç†**
  - åœ¨æ—©æœŸè¿›è¡Œè·¨è§†è§’å¯¹é½ï¼Œå‡å°‘åç»­å±‚çš„è´Ÿæ‹…
  - LoRAè®¾è®¡é™ä½å‚æ•°é‡ï¼Œç¬¦åˆè½»é‡çº§è¦æ±‚

#### âœ… ä¿®æ”¹2: å¤šè§†è§’Tokenç»“æ„
**vggt_t_mask_mlp_fin10**ï¼š
- Camera token: `[1, 2, 1, C]` (ç¬¬ä¸€å¸§ vs å…¶ä»–å¸§)
- Register token: `[1, 2, 4, C]` (ç¬¬ä¸€å¸§ vs å…¶ä»–å¸§)
- ä½¿ç”¨ `slice_expand_and_flatten` å±•å¼€

**mv_page4d_lite**ï¼š
- Camera token: `[1, V, 1, C]` (æ¯ä¸ªè§†è§’ä¸€ä¸ªï¼Œè·¨æ—¶é—´å…±äº«)
- Register token: `[1, T, 4, C]` (æ¯ä¸ªæ—¶é—´æ­¥4ä¸ª)
- å±•å¼€é€»è¾‘ï¼šcameraæŒ‰è§†è§’å±•å¼€ï¼ŒregisteræŒ‰æ—¶é—´å±•å¼€

- **åˆç†æ€§**ï¼šâœ… **åˆç†ä¸”å¿…è¦**
  - æ›´ç¬¦åˆå¤šè§†è§’æ—¶åºæ•°æ®çš„è¯­ä¹‰ï¼ˆè§†è§’å‚æ•°åº”è·¨æ—¶é—´ä¸€è‡´ï¼‰
  - æ—¶é—´ç›¸å…³çš„register tokenså¯ä»¥æ›´å¥½åœ°å»ºæ¨¡æ—¶åºä¿¡æ¯

#### âœ… ä¿®æ”¹3: æ—¶é—´/è§†è§’åµŒå…¥
**æ–°å¢æ¨¡å—**ï¼š
- `time_embed`: `nn.Embedding(max_time_steps=100, embed_dim=1024)`
- `view_embed`: `nn.Embedding(max_views=32, embed_dim=1024)`
- `camera_param_embed`: `nn.Sequential(Linear(1â†’256), GELU, Linear(256â†’1024))`

**æ³¨å…¥æ–¹å¼**ï¼š
- Time embedding + View embedding â†’ æ·»åŠ åˆ°patch tokens
- Camera param embedding â†’ æ·»åŠ åˆ°camera token

- **åˆç†æ€§**ï¼šâœ… **åˆç†**
  - æ˜¾å¼ç¼–ç æ—¶é—´å’Œè§†è§’ä¿¡æ¯ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£å¤šè§†è§’æ—¶åºç»“æ„
  - ä½ç½®ç¼–ç çš„æ‰©å±•ï¼Œç¬¦åˆTransformeræ¶æ„è®¾è®¡

#### âœ… ä¿®æ”¹4: ä¸‰é˜¶æ®µè·¯ç”±ç­–ç•¥
**vggt_t_mask_mlp_fin10**ï¼š
- æ‰€æœ‰frame attentionéƒ½æ˜¯æ ‡å‡†åºåˆ—æ³¨æ„åŠ›ï¼ˆæ— è·¯ç”±å˜åŒ–ï¼‰

**mv_page4d_lite**ï¼š
- **Stage-1 (0-7å±‚)**: Multi-view routing
  - Frame attention: `[B, T, V, P, C]` â†’ `[B*T, V*P, C]`
  - åŒä¸€æ—¶é—´æ­¥å†…ï¼Œä¸åŒè§†è§’é—´æ³¨æ„åŠ›
- **Stage-2 (8-17å±‚)**: Temporal routing
  - Frame attention: `[B, T, V, P, C]` â†’ `[B*V, T*P, C]`
  - åŒä¸€è§†è§’å†…ï¼Œä¸åŒæ—¶é—´æ­¥é—´æ³¨æ„åŠ›
- **Stage-3 (18-23å±‚)**: æ··åˆè·¯ç”±
  - å‰3å±‚ï¼šTemporal
  - å3å±‚ï¼šMulti-view

- **åˆç†æ€§**ï¼šâœ… **éå¸¸åˆç†**
  - Stage-1å…ˆèšåˆå¤šè§†è§’ä¿¡æ¯ï¼ˆç©ºé—´ä¸€è‡´æ€§ï¼‰
  - Stage-2å†å»ºæ¨¡æ—¶åºä¿¡æ¯ï¼ˆæ—¶é—´ä¸€è‡´æ€§ï¼‰
  - Stage-3æ··åˆå¹³è¡¡ä¸¤ç§ä¿¡æ¯
  - è¿™ç§åˆ†å±‚è®¾è®¡ç¬¦åˆå¤šè§†è§’æ—¶åºé‡å»ºçš„è®¤çŸ¥è¿‡ç¨‹

#### âœ… ä¿®æ”¹5: å¯å­¦ä¹ çš„ç›¸æœºMaské—¨æ§
**æ–°å¢å‚æ•°**ï¼š
- `camera_mask_gate`: `nn.Parameter(torch.zeros(1))`
- æ¿€æ´»ï¼š`Î³ = sigmoid(camera_mask_gate)`

**åº”ç”¨**ï¼š
- Camera branch mask: `Î³ Ã— cache_mask` (å¼±masking)
- Register branch mask: `cache_mask` (å¼ºmasking)

- **åˆç†æ€§**ï¼šâœ… **åˆç†ä½†æœ‰æ”¹è¿›ç©ºé—´**
  - å…è®¸æ¨¡å‹è‡ªé€‚åº”è°ƒæ•´maskå¼ºåº¦
  - **é—®é¢˜**ï¼šåªç”¨ä¸€ä¸ªæ ‡é‡Î³æ§åˆ¶æ‰€æœ‰maskï¼Œå¯èƒ½ä¸å¤Ÿçµæ´»
  - **å»ºè®®**ï¼šå¯ä»¥å°è¯•per-layeræˆ–per-headçš„Î³

#### âœ… ä¿®æ”¹6: è¾“å…¥æ ¼å¼æ”¯æŒ
**vggt_t_mask_mlp_fin10**ï¼š
- ä»…æ”¯æŒ `[B, S, 3, H, W]` (legacyæ ¼å¼)

**mv_page4d_lite**ï¼š
- åŒæ—¶æ”¯æŒ `[B, T, V, 3, H, W]` (å¤šè§†è§’) å’Œ `[B, S, 3, H, W]` (legacy)
- è‡ªåŠ¨æ£€æµ‹è¾“å…¥æ ¼å¼ï¼š`is_multi_view = len(images.shape) == 6`

- **åˆç†æ€§**ï¼šâœ… **å¿…è¦ä¸”å®ç°è‰¯å¥½**
  - ä¿æŒå‘åå…¼å®¹æ€§
  - æ¸…æ™°çš„æ ¼å¼æ£€æµ‹å’Œç»Ÿä¸€å¤„ç†

#### âœ… ä¿®æ”¹7: CameraHeadå¤šè§†è§’é€‚é…
**ä¿®æ”¹ç‚¹**ï¼š
- ä» `[B, T*V, P, C]` ä¸­æå–æ¯ä¸ªè§†è§’çš„camera token
- åˆ†åˆ«å¤„ç†æ¯ä¸ªè§†è§’ï¼Œè¾“å‡º `[B, V, 9]`
- ä¿æŒè·¨æ—¶é—´å…±äº«çš„è¯­ä¹‰ï¼ˆä»ç¬¬ä¸€ä¸ªæ—¶é—´æ­¥æå–ï¼‰

- **åˆç†æ€§**ï¼šâœ… **åˆç†**
  - ç¬¦åˆç›¸æœºå‚æ•°åº”è·¨æ—¶é—´ä¸€è‡´çš„è¦æ±‚

---

### 2.2 ä¿ç•™çš„æœºåˆ¶

#### âœ… SpatialMaskHead (åŠ¨æ€åŒºåŸŸæ£€æµ‹)
- ä½ç½®ï¼šLayer 7ä¹‹åç”Ÿæˆmask
- åŠŸèƒ½ï¼šæ£€æµ‹åŠ¨æ€ç‰©ä½“åŒºåŸŸ
- åœ¨å¤šè§†è§’æ¨¡å¼ä¸‹ä»ç„¶æœ‰æ•ˆ

#### âœ… Alternating Attention
- Frame attention + Global attention äº¤æ›¿
- 24å±‚ç»“æ„ä¿æŒä¸å˜

#### âœ… DPT Headæ¶æ„
- Depth/Pointé¢„æµ‹å¤´ç»“æ„ä¸å˜
- ä»…é€‚é…å¤šè§†è§’è¾“å‡ºæ ¼å¼

---

## 3. æ”¹è¿›å»ºè®®

### 3.1 æ¶æ„æ”¹è¿›

#### ğŸ”§ å»ºè®®1: å¢å¼ºCamera Maské—¨æ§
**å½“å‰é—®é¢˜**ï¼š
- å•ä¸€çš„æ ‡é‡Î³æ§åˆ¶æ‰€æœ‰mask
- å¯èƒ½æ— æ³•é€‚åº”ä¸åŒå±‚çš„maskéœ€æ±‚

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š
```python
# å½“å‰
self.camera_mask_gate = nn.Parameter(torch.zeros(1))

# æ”¹è¿›ï¼šper-layeré—¨æ§
self.camera_mask_gates = nn.Parameter(torch.zeros(24))  # æ¯å±‚ä¸€ä¸ª
```

#### ğŸ”§ å»ºè®®2: ViewMixerçš„å‡ ä½•å¼•å¯¼
**å½“å‰çŠ¶æ€**ï¼š
- `use_geometry_guidance=False`
- `_geometry_guided_aggregation` æœªå®ç°

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š
- å®ç°åŸºäºç›¸æœºå¤–å‚çš„å‡ ä½•å¼•å¯¼èšåˆ
- ä½¿ç”¨epipolar geometryçº¦æŸè·¨è§†è§’åŒ¹é…
- å¯ä»¥æé«˜åŠ¨æ€åœºæ™¯ä¸‹çš„é²æ£’æ€§

#### ğŸ”§ å»ºè®®3: Stage-3è·¯ç”±ç­–ç•¥
**å½“å‰å®ç°**ï¼š
- ç¡¬ç¼–ç ï¼šå‰3å±‚temporalï¼Œå3å±‚multi-view

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š
- å¯å­¦ä¹ çš„è·¯ç”±æƒé‡ï¼ˆsoft routingï¼‰
- æˆ–åŸºäºattention scoreçš„è‡ªé€‚åº”è·¯ç”±

### 3.2 è®­ç»ƒç­–ç•¥æ”¹è¿›

#### ğŸ”§ å»ºè®®4: å¤šé˜¶æ®µè®­ç»ƒ
**å½“å‰**ï¼š
- Stage 1: å†»ç»“åŸºç¡€ç‰¹å¾ï¼Œè®­ç»ƒæ–°å¢æ¨¡å—

**æ”¹è¿›**ï¼š
- Stage 1: è®­ç»ƒViewMixer + Stage-2 (å¦‚å½“å‰)
- Stage 2: è§£å†»Stage-1ï¼Œç«¯åˆ°ç«¯å¾®è°ƒ
- Stage 3: è§£å†»æ‰€æœ‰å±‚ï¼Œå…¨é‡å¾®è°ƒ

#### ğŸ”§ å»ºè®®5: æŸå¤±å‡½æ•°
**å½“å‰æŸå¤±**ï¼š
- Multi-view consistency loss
- SegAnyMo mask supervision
- Dual stream separation loss

**å¯æ·»åŠ **ï¼š
- Epipolar constraint loss (å‡ ä½•ä¸€è‡´æ€§)
- Cross-view photometric loss (å…‰åº¦ä¸€è‡´æ€§)
- æ—¶é—´å¹³æ»‘æ€§æŸå¤± (temporal smoothness)

### 3.3 å®ç°ç»†èŠ‚æ”¹è¿›

#### ğŸ”§ å»ºè®®6: Memoryä¼˜åŒ–
**å½“å‰é—®é¢˜**ï¼š
- å¤šè§†è§’æ¨¡å¼ä¸‹ `[B, T, V, P, C]` å¼ é‡è¾ƒå¤§
- ViewMixeråœ¨ `[B*T, V*P, C]` ä¸Šåšæ³¨æ„åŠ›ï¼Œå†…å­˜æ¶ˆè€—å¤§

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š
- å®ç°chunked attentionï¼ˆåˆ†å—å¤„ç†ï¼‰
- æˆ–ä½¿ç”¨çº¿æ€§attentionå˜ä½“

#### ğŸ”§ å»ºè®®7: ä½ç½®åµŒå…¥
**å½“å‰**ï¼š
- RoPEç”¨äºpatch tokens
- Time/View embeddingå•ç‹¬æ³¨å…¥

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š
- è€ƒè™‘è”åˆçš„ä½ç½®-æ—¶é—´-è§†è§’åµŒå…¥
- æˆ–ä½¿ç”¨å¯å­¦ä¹ çš„ç›¸å¯¹ä½ç½®åµŒå…¥

---

## 4. æ€»ç»“

### 4.1 ä¸»è¦ä¼˜åŠ¿
1. âœ… **å¤šè§†è§’æ¶æ„è®¾è®¡åˆç†**ï¼šViewMixer + ä¸‰é˜¶æ®µè·¯ç”± + å¤šè§†è§’tokenç»“æ„
2. âœ… **ä¿æŒå‘åå…¼å®¹**ï¼šæ”¯æŒlegacyå’Œå¤šè§†è§’ä¸¤ç§è¾“å…¥æ ¼å¼
3. âœ… **è½»é‡çº§è®¾è®¡**ï¼šViewMixerä½¿ç”¨LoRAï¼Œå‚æ•°é‡å°
4. âœ… **è¯­ä¹‰æ¸…æ™°**ï¼šç›¸æœºtokenè·¨æ—¶é—´å…±äº«ï¼Œregister tokenæŒ‰æ—¶é—´ç»„ç»‡

### 4.2 æ½œåœ¨é—®é¢˜
1. âš ï¸ **å•ä¸€maské—¨æ§**ï¼šå¯èƒ½ä¸å¤Ÿçµæ´»
2. âš ï¸ **ViewMixeræœªä½¿ç”¨å‡ ä½•ä¿¡æ¯**ï¼šå‡ ä½•å¼•å¯¼åŠŸèƒ½æœªå®ç°
3. âš ï¸ **å†…å­˜æ¶ˆè€—**ï¼šå¤šè§†è§’æ¨¡å¼ä¸‹å¯èƒ½éœ€è¦chunking

### 4.3 æ€»ä½“è¯„ä»·
**ä¿®æ”¹åˆç†æ€§ï¼šâ­â­â­â­â­ (5/5)**
- æ‰€æœ‰æ ¸å¿ƒä¿®æ”¹éƒ½æœ‰æ˜ç¡®çš„åŠ¨æœºå’Œåˆç†çš„å®ç°
- ä¸‰é˜¶æ®µè·¯ç”±ç­–ç•¥æ˜¯äº®ç‚¹ï¼Œç¬¦åˆå¤šè§†è§’æ—¶åºé‡å»ºçš„è®¤çŸ¥è¿‡ç¨‹
- ViewMixerçš„å¼•å…¥æ°åˆ°å¥½å¤„

**æ”¹è¿›ç©ºé—´ï¼šâ­â­â­ (3/5)**
- æœ‰ä¸€äº›ç»†èŠ‚å¯ä»¥ä¼˜åŒ–ï¼ˆå¦‚maské—¨æ§ã€å‡ ä½•å¼•å¯¼ï¼‰
- ä½†ä¸å½±å“æ•´ä½“æ¶æ„çš„åˆç†æ€§

**ç»“è®º**ï¼šmv_page4d_liteç›¸æ¯”vggt_t_mask_mlp_fin10çš„ä¿®æ”¹æ˜¯**åˆç†ä¸”å¿…è¦çš„**ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šè§†è§’tokenç»“æ„ã€ä¸‰é˜¶æ®µè·¯ç”±ç­–ç•¥å’ŒViewMixerè®¾è®¡æ–¹é¢ã€‚è¿™äº›ä¿®æ”¹ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†å¤šè§†è§’æ—¶åºæ•°æ®ï¼Œæ˜¯ä¸€ä¸ª**æˆåŠŸä¸”æœ‰æ„ä¹‰**çš„æ¶æ„å‡çº§ã€‚

